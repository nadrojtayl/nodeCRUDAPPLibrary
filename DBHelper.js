"use strict";function Objectmap(a,b){for(var c in a)a[c]=b(a[c])}function createConnections(){}function createDBAjaxReq(a,b,c,d){c=c?"'"+c+"'":"'get'";var e="http://"+d+":"+b+a;return"console.log(data); var toReturn = ''; $.ajax({type:"+c+",url:'"+e+"',async:false,success:function(returnData){toReturn = JSON.parse(returnData)},failure:function(err){console.log(err)},data:data}); return toReturn;"}var bodyparser=require("body-parser"),fs=require("fs"),mongoose=require("mongoose");class a{constructor(a,b,c,d){console.log("PORT IS",b),this.app=a,this.app.use(bodyparser.urlencoded({extended:!0})),this.app.use(bodyparser.json()),this.port=b,this.mongooseInstance=c,this.entities={},this.helpers=[],this.clientMethods={},this.filePaths={},this.ipAddress=d}printHelpers(){console.log(Object.keys(this.clientMethods))}sendFileWithDBMethods(a,b){var c='<script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>',d="<script>var db ="+JSON.stringify(this.clientMethods)+";for(var key in db){db[key] = new Function('data',db[key])}</script>";if(d=c+d,this.filePaths[a])var e=this.filePaths[a];else{var e=fs.readFileSync(a,"utf8");this.filePaths[a]=e}var f=e.indexOf("<head>")+7;e=e.slice(0,f)+d+e.slice(f),b.send(e)}createSchema(a,b){var c=this.mongooseInstance.Schema,d=!0,e=["string","number","boolean","Date","[]","object"];for(var f in a)Objectmap(a[f],function(a){var b;return a.constructor===Date&&(b="date"),Array.isArray(a)&&(b="[]"),b=typeof a,e.indexOf(b)===-1&&(d=!1),b});for(var f in a){b&&b[f]&&b[f].forEach(function(b){a[f][b+"s"]=[{type:c.Types.ObjectId,ref:b}],a[b]["_"+f]={type:mongoose.Schema.Types.ObjectId,ref:f,required:!0}});var g=new c(a[f]);this.entities[f]=this.mongooseInstance.model(f,g)}var h={};for(var f in b)b[f].forEach(function(a){a in h?h[a].push(f):h[a]=[f]});if(!d)throw"Your example must only include types that can be instantiated in mongoose";for(var i in this.entities){var j=this,k=function(){var a=i;if(i in h){var b="";h[a].forEach(function(a,c){b+=0===c?a:"and"+a}),j.helpers["add"+a+"for"+b]=function(b,c,d){function h(d,f){if(e[f])j.entities[e[f]].findOne(b[e[f]]).exec(function(a,b){g[e[f]]=b._id,h(d,f+1)});else{for(var i in g)c["_"+i]=g[i];var k=new j.entities[a](c);k.save(function(a,b){d(b)})}}var e=Object.keys(b),g={};h(d,0)},j.app.post("/add"+a+"for"+b,function(c,d){d.setHeader("Access-Control-Allow-Headers","x-requested-with"),d.setHeader("Access-Control-Allow-Origin","*");var f=(c.body,c.body.relatedInfo),g=c.body.toPost;j.helpers["add"+a+"for"+b](f,g,function(a){d.end(JSON.stringify(a))})}),j.clientMethods["add"+a+"for"+b]=createDBAjaxReq("/add"+a+"for"+b,j.port,"post",j.ipAddress)}j.helpers["getAll"+a+"s"]=function(b){j.entities[a].find({}).exec(function(a,c){b(JSON.stringify(c))})},j.app.get("/getAll"+a+"s",function(b,c){j.helpers["getAll"+a+"s"](function(a){c.setHeader("Access-Control-Allow-Headers","x-requested-with"),c.setHeader("Access-Control-Allow-Origin","*"),c.end(a)})}),j.clientMethods["getAll"+a+"s"]=createDBAjaxReq("/getAll"+a+"s",j.port,"get",j.ipAddress),j.helpers["getSpecific"+a]=function(b,c){j.entities[a].find(b).exec(function(a,b){c(a?a:JSON.stringify(b))})},j.app.post("/getSpecific"+a,function(b,c){c.setHeader("Access-Control-Allow-Headers","x-requested-with"),c.setHeader("Access-Control-Allow-Origin","*");var d=b.body;j.helpers["getSpecific"+a](d,function(a){c.end(a)})}),j.clientMethods["getSpecific"+a]=createDBAjaxReq("/getSpecific"+a,j.port,"post",j.ipAddress),j.helpers["add"+a]=function(b,c){j.entities[a].find(b).exec(function(d,e){d?(console.log(d),c(d)):e.length>0?c(JSON.stringify(["That record was already there!"])):j.entities[a].create(b,function(a,b){console.log(b);var d;d=a?a:JSON.stringify(b),c(JSON.stringify(d))})})},j.app.post("/add"+a,function(b,c){c.setHeader("Access-Control-Allow-Headers","x-requested-with"),c.setHeader("Access-Control-Allow-Origin","*");var d=b.body;j.helpers["add"+a](d,function(a){c.end(a)})}),j.clientMethods["add"+a]=createDBAjaxReq("/add"+a,j.port,"post",j.ipAddress),j.helpers["update"+a]=function(b,c,d){j.entities[a].findOneAndUpdate(b,c,{},function(a,b){d(a?a:JSON.stringify(b))})},j.app.post("/update"+a,function(b,c){c.setHeader("Access-Control-Allow-Headers","x-requested-with"),c.setHeader("Access-Control-Allow-Origin","*");var d=b.body.find,e=b.body.change;j.helpers["update"+a](d,e,function(a){c.end(a)})}),j.clientMethods["update"+a]=createDBAjaxReq("/update"+a,j.port,"post",j.ipAddress),j.helpers["delete"+a]=function(b,c){j.entities[a].findOneAndRemove(b,{},function(a,b){c(a?a:JSON.stringify(b))})},j.app.post("/delete"+a,function(b,c){c.setHeader("Access-Control-Allow-Headers","x-requested-with"),c.setHeader("Access-Control-Allow-Origin","*");var d=b.body;j.helpers["delete"+a](d,function(a){c.end(a)})}),j.clientMethods["delete"+a]=createDBAjaxReq("/delete"+a,j.port,"post",j.ipAddress)};k()}}}module.exports=a;